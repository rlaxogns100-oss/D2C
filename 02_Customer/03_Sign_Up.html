<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>03 Sign Up</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="screen-label">Sign_Up</div>
  
  <div class="auth-container">
    <!-- Header -->
    <div class="auth-header">
      <button class="icon-btn back-btn" onclick="history.back()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      <h1>Sign Up</h1>
      <p>Please sign up to get started</p>
    </div>
    
    <!-- Form -->
    <div class="auth-form">
      <form onsubmit="return validateSignUp(event)">
        <div class="form-group">
          <label class="form-label" for="name">NAME</label>
          <input 
            type="text" 
            id="name" 
            class="form-input" 
            placeholder="John doe"
            required
          >
        </div>
        
        <div class="form-group">
          <label class="form-label" for="email">EMAIL</label>
          <input 
            type="email" 
            id="email" 
            class="form-input" 
            placeholder="example@gmail.com"
            required
          >
        </div>
        
        <div class="form-group">
          <label class="form-label" for="password">PASSWORD</label>
          <div class="password-input-wrapper">
            <input 
              type="password" 
              id="password" 
              class="form-input" 
              placeholder="••••••••••"
              required
            >
            <button type="button" class="password-toggle" onclick="togglePassword('password')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="confirm-password">RE-TYPE PASSWORD</label>
          <div class="password-input-wrapper">
            <input 
              type="password" 
              id="confirm-password" 
              class="form-input" 
              placeholder="••••••••••"
              required
            >
            <button type="button" class="password-toggle" onclick="togglePassword('confirm-password')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
          </div>
        </div>
        
        <button type="submit" class="btn-primary">SIGN UP</button>
      </form>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
    // 회원가입 폼 유효성 검사
    async function validateSignUp(event) {
      event.preventDefault();
      
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      
      // 이름 빈 값 체크
      if (name === '') {
        alert('이름을 입력해주세요');
        return false;
      }
      
      // 이름 길이 체크
      if (name.length < 2) {
        alert('이름은 2자 이상이어야 합니다');
        return false;
      }
      
      // 이메일 빈 값 체크
      if (email === '') {
        alert('이메일을 입력해주세요');
        return false;
      }
      
      // 이메일 형식 체크
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailPattern.test(email)) {
        alert('올바른 이메일 형식이 아닙니다\n예: example@gmail.com');
        return false;
      }
      
      // 비밀번호 빈 값 체크
      if (password === '') {
        alert('비밀번호를 입력해주세요');
        return false;
      }
      
      // 비밀번호 길이 체크
      if (password.length < 6) {
        alert('비밀번호는 6자 이상이어야 합니다');
        return false;
      }
      
      // 비밀번호 확인 빈 값 체크
      if (confirmPassword === '') {
        alert('비밀번호 확인을 입력해주세요');
        return false;
      }
      
      // 비밀번호 일치 확인
      if (password !== confirmPassword) {
        alert('비밀번호가 일치하지 않습니다');
        return false;
      }
      
      // 모든 검사 통과
      try {
        // API 명세에 따른 회원가입 요청
        const response = await axios.post('/api/v1/users/signup', {
          id: email,          // 명세서의 id (email)
          password: password, // 명세서의 password
          role: 'CUSTOMER',   // 손님 역할 고정
          name: name          // 이름
        });

        if (response.status === 200 || response.status === 201) {
          alert('회원가입 성공!');
          location.href = '04_Home.html';
        }
      } catch (error) {
        console.error('Signup error:', error);
        
        // 서버가 없거나 응답이 없는 경우 (테스트용)
        if (!error.response) {
          alert('서버와 연결할 수 없습니다.\n(테스트 모드: 홈으로 이동합니다)');
          // 실제 운영 시에는 아래 줄 삭제
          location.href = '04_Home.html';
          return false;
        }
        
        alert('회원가입 실패: ' + (error.response?.data?.message || '오류가 발생했습니다.'));
      }

      return false;
    }
    
    // 비밀번호 표시/숨기기
    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      if (input.type === 'password') {
        input.type = 'text';
      } else {
        input.type = 'password';
      }
    }
  </script>
</body>
</html>
