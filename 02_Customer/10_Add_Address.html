<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>10 Add Address</title>
  <link rel="stylesheet" href="style.css">
  <!-- âš ï¸ LocalStorage Service (DB ì—°ë™ ì‹œ ì´ ì¤„ ì‚­ì œ) -->
  <script src="storage.js"></script>
</head>
<body>
  <div class="screen-label">Add_New_Address</div>
  
  <div class="container">
    <!-- Header -->
    <div class="orders-header">
      <button class="icon-btn back-btn" style="position: static;" onclick="history.back()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      <div style="width: 40px;"></div>
    </div>
    
    <!-- Map -->
    <div class="map-container">
      <div class="map-marker"></div>
      <button style="position: absolute; top: 16px; right: 16px; padding: 8px 16px; background: #2D3E50; color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer;">
        Move to edit location
      </button>
    </div>
    
    <!-- Address Preview -->
    <div class="address-preview">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
        <circle cx="12" cy="10" r="3"/>
      </svg>
      <p>3235 Royal Ln. Mesa, New Jersy 34567</p>
    </div>
    
    <!-- Form -->
    <form onsubmit="return validateAddress(event)">
      <div class="form-group">
        <label class="form-label" for="street">STREET</label>
        <div class="form-row">
          <input 
            type="text" 
            id="street" 
            class="form-input" 
            placeholder="Hasan Nagar"
            style="grid-column: 1 / -1;"
            required
          >
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="postcode">POST CODE</label>
          <input 
            type="text" 
            id="postcode" 
            class="form-input" 
            placeholder="34567"
            required
          >
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="apartment">APPARTMENT</label>
        <input 
          type="text" 
          id="apartment" 
          class="form-input" 
          placeholder="345"
        >
      </div>
      
      <div class="form-group">
        <label class="form-label">LABEL AS</label>
        <div class="label-options">
          <button type="button" class="label-btn active" onclick="selectLabel(this)">Home</button>
          <button type="button" class="label-btn" onclick="selectLabel(this)">Work</button>
          <button type="button" class="label-btn" onclick="selectLabel(this)">Other</button>
        </div>
      </div>
      
      <button type="submit" class="btn-primary">SAVE LOCATION</button>
    </form>
  </div>
  
  <script>
    // ë¼ë²¨ ì„ íƒ ê¸°ëŠ¥
    function selectLabel(button) {
      // ëª¨ë“  ë¼ë²¨ ë²„íŠ¼ì˜ active í´ë˜ìŠ¤ ì œê±°
      document.querySelectorAll('.label-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      // í´ë¦­í•œ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
      button.classList.add('active');
    }
    
    /* ==========================================================================
       ğŸ“ ì£¼ì†Œ ì¶”ê°€ í˜ì´ì§€ ë¡œì§
       
       âš ï¸ DB ì—°ë™ ì‹œ ìˆ˜ì • í•„ìš”:
       - AddressStorage.addAddress() â†’ fetch('/api/addresses', {method:'POST'})
       ========================================================================== */
    
    // ì£¼ì†Œ í¼ ìœ íš¨ì„± ê²€ì‚¬
    function validateAddress(event) {
      event.preventDefault();
      
      const street = document.getElementById('street').value.trim();
      const postcode = document.getElementById('postcode').value.trim();
      const apartment = document.getElementById('apartment').value.trim();
      
      // ê±°ë¦¬ ì£¼ì†Œ ë¹ˆ ê°’ ì²´í¬
      if (street === '') {
        alert('ê±°ë¦¬ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return false;
      }
      
      // ê±°ë¦¬ ì£¼ì†Œ ê¸¸ì´ ì²´í¬
      if (street.length < 5) {
        alert('ê±°ë¦¬ ì£¼ì†ŒëŠ” 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return false;
      }
      
      // ìš°í¸ë²ˆí˜¸ ë¹ˆ ê°’ ì²´í¬
      if (postcode === '') {
        alert('ìš°í¸ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return false;
      }
      
      // ìš°í¸ë²ˆí˜¸ ìˆ«ì ì²´í¬
      if (!/^\d+$/.test(postcode)) {
        alert('ìš°í¸ë²ˆí˜¸ëŠ” ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return false;
      }
      
      // ìš°í¸ë²ˆí˜¸ ê¸¸ì´ ì²´í¬ (5ìë¦¬)
      if (postcode.length !== 5) {
        alert('ìš°í¸ë²ˆí˜¸ëŠ” 5ìë¦¬ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤');
        return false;
      }
      
      // ì„ íƒëœ ë¼ë²¨ ê°€ì ¸ì˜¤ê¸°
      const labelButton = document.querySelector('.label-btn.active');
      const label = labelButton ? labelButton.textContent : 'Home';
      
      // ì£¼ì†Œ ê°ì²´ ìƒì„±
      const address = {
        street: street,
        postcode: postcode,
        apartment: apartment,
        label: label,
        fullAddress: `${street}, ${apartment ? apartment + ', ' : ''}${postcode}`
      };
      
      // LocalStorageì— ì €ì¥
      AddressStorage.addAddress(address); // âš ï¸ DB: await fetch('/api/addresses', {method:'POST', body:JSON.stringify(address)})
      
      // ëª¨ë“  ê²€ì‚¬ í†µê³¼
      alert('ì£¼ì†Œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      location.href = '09_Address.html';
      return false;
    }
  </script>
</body>
</html>
