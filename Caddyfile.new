# ============================================================================
# ğŸš€ ìƒˆ í”„ë¡ íŠ¸ì—”ë“œìš© Caddyfile (SPA ë¼ìš°íŒ… ì§€ì›)
# ============================================================================
# 
# ğŸ“Œ êµì²´ ë°©ë²•:
#   1. ê¸°ì¡´ Caddyfile ë°±ì—…: cp /etc/caddy/Caddyfile /etc/caddy/Caddyfile.backup
#   2. ìƒˆ ì„¤ì • ì ìš©: sudo cp Caddyfile.new /etc/caddy/Caddyfile
#   3. Caddy ì¬ì‹œì‘: sudo systemctl reload caddy
#
# âš ï¸ ë¡¤ë°± ë°©ë²•:
#   sudo cp /etc/caddy/Caddyfile.backup /etc/caddy/Caddyfile
#   sudo systemctl reload caddy
#
# ============================================================================

# 1. ë©”ì¸ ëœë”© í˜ì´ì§€ + í†µí•© ê´€ë¦¬ì + ì ì£¼ í˜ì´ì§€ (maejang.com)
maejang.com {
    
    # [ìš°ì„ ìˆœìœ„ 1] ë°±ì—”ë“œ API
    handle /api/* {
        reverse_proxy localhost:8080
    }
    
    # [ìš°ì„ ìˆœìœ„ 2] /owner â†’ ì ì£¼ í†µí•© ê´€ë¦¬ í˜ì´ì§€ (ìƒˆ ê²½ë¡œ)
    handle /owner* {
        @without_slash path /owner
        redir @without_slash /owner/
        
        uri strip_prefix /owner
        root * /home/ubuntu/D2C/08_new_owner
        file_server
        
        # SPA ë¼ìš°íŒ…
        try_files {path} /index.html
    }
    
    # [ìš°ì„ ìˆœìœ„ 3] /admin â†’ ê¸°ì¡´ í†µí•© ê´€ë¦¬ì í˜ì´ì§€
    redir /admin /admin/
    
    handle_path /admin/* {
        root * /home/ubuntu/D2C/00_Admin
        file_server
        try_files {path} {path}/ /index.html
    }
    
    # [ìš°ì„ ìˆœìœ„ 4] ë‚˜ë¨¸ì§€ â†’ í™ˆí˜ì´ì§€
    handle {
        root * /home/ubuntu/D2C/01_Homepage
        file_server
        try_files {path} {path}/ /index.html
    }
    
    log {
        output file /var/log/caddy/maejang.access.log
    }
}

# 2. pizzaschool ì„œë¸Œë„ë©”ì¸ (ìƒˆ í”„ë¡ íŠ¸ì—”ë“œ)
pizzaschool.maejang.com {
    
    # [ìš°ì„ ìˆœìœ„ 1] ë°±ì—”ë“œ API
    handle /api/* {
        reverse_proxy localhost:8080
    }

    # [ìš°ì„ ìˆœìœ„ 2] ì ì£¼ í˜ì´ì§€ (/admin) - ìƒˆ í”„ë¡ íŠ¸ì—”ë“œ
    handle /admin* {
        @without_slash path /admin
        redir @without_slash /admin/
        
        uri strip_prefix /admin
        root * /home/ubuntu/D2C/08_new_owner
        file_server
        
        # SPA ë¼ìš°íŒ…: ëª¨ë“  ê²½ë¡œë¥¼ index.htmlë¡œ
        try_files {path} /index.html
    }

    # [ìš°ì„ ìˆœìœ„ 3] ê³ ê°ìš© í˜ì´ì§€ - ìƒˆ í”„ë¡ íŠ¸ì—”ë“œ
    handle {
        root * /home/ubuntu/D2C/07_new_front
        file_server
        
        # SPA ë¼ìš°íŒ…: ëª¨ë“  ê²½ë¡œë¥¼ index.htmlë¡œ
        try_files {path} /index.html
    }

    log {
        output file /var/log/caddy/pizzaschool.access.log
    }
}

# 3. 7room ì„œë¸Œë„ë©”ì¸ (ê¸°ì¡´ ìœ ì§€ - ì•ˆì „í•˜ê²Œ)
7room.maejang.com {
    
    # [ìš°ì„ ìˆœìœ„ 1] ë°±ì—”ë“œ API
    handle /api/* {
        reverse_proxy localhost:8080
    }

    # [ìš°ì„ ìˆœìœ„ 2] ì ì£¼ í˜ì´ì§€ (/admin)
    handle /admin* {
        @without_slash path /admin
        redir @without_slash /admin/
        
        uri strip_prefix /admin
        root * /home/ubuntu/D2C/02_Owner
        file_server
        try_files {path} /01_Loading.html
    }

    # [ìš°ì„ ìˆœìœ„ 3] ë‚˜ë¨¸ì§€ ëª¨ë“  ìš”ì²­ (ê³ ê°ìš© ì •ì  íŒŒì¼)
    handle {
        root * /home/ubuntu/D2C/03_Customer
        file_server
        
        rewrite / /01_Loading.html
        try_files {path} {path}/ /01_Loading.html
    }

    log {
        output file /var/log/caddy/7room.access.log
    }
}

