<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D2C í†µí•© ê´€ë¦¬ì</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ëª¨ë‹¬ */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .auth-modal {
            background: white;
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .auth-modal h2 {
            font-size: 24px;
            margin-bottom: 8px;
            color: #1F2937;
        }
        
        .auth-modal p {
            color: #6B7280;
            margin-bottom: 24px;
        }
        
        .auth-modal input {
            width: 100%;
            padding: 14px;
            font-size: 18px;
            text-align: center;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            margin-bottom: 16px;
            letter-spacing: 4px;
        }
        
        .auth-modal input:focus {
            outline: none;
            border-color: #4F46E5;
        }
        
        .auth-modal button {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            background: #4F46E5;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .auth-modal button:hover {
            background: #4338CA;
        }
        
        .auth-error {
            color: #EF4444;
            font-size: 14px;
            margin-top: 12px;
            display: none;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* ì„œë¸Œë„ë©”ì¸ ì—´ ìŠ¤íƒ€ì¼ */
        .subdomain-link {
            color: #4F46E5;
            text-decoration: none;
            font-family: monospace;
        }
        
        .subdomain-link:hover {
            text-decoration: underline;
        }
        
        .no-subdomain {
            color: #9CA3AF;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ëª¨ë‹¬ -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-modal">
            <h2>ğŸ” ê´€ë¦¬ì ì¸ì¦</h2>
            <p>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            <input type="password" id="authPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" maxlength="10" onkeyup="if(event.key==='Enter') checkAuth()">
            <button onclick="checkAuth()">í™•ì¸</button>
            <div class="auth-error" id="authError">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤</div>
        </div>
    </div>

    <div class="admin-container hidden" id="adminContainer">
        <!-- ì‚¬ì´ë“œë°” -->
        <nav class="sidebar">
            <div class="logo-area">
                <h2>D2C Admin</h2>
            </div>
            <ul class="menu-list">
                <li class="menu-item active"><a href="#">ë§¤ì¥ ê´€ë¦¬</a></li>
                <li class="menu-item"><a href="01_Store_Match.html">ë§¤ì¥ ë§¤ì¹­</a></li>
                <li class="menu-item"><a href="#">íšŒì› ê´€ë¦¬</a></li>
                <li class="menu-item"><a href="#">ì£¼ë¬¸ í˜„í™©</a></li>
                <li class="menu-item"><a href="03_Profit_Simulation.html">ìˆ˜ìµ ì‹œë®¬ë ˆì´ì…˜</a></li>
                <li class="menu-item"><a href="#">ì„¤ì •</a></li>
            </ul>
        </nav>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="main-content">
            <!-- íƒ‘ë°” -->
            <header class="topbar">
                <div class="page-title">ë§¤ì¥ ê´€ë¦¬</div>
                <div class="user-info">
                    <span>Super Adminë‹˜</span>
                    <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </header>

            <!-- ì»¨í…ì¸  ì˜ì—­ -->
            <main class="content-area">
                <div class="action-bar">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="ë§¤ì¥ëª… ë˜ëŠ” ì„œë¸Œë„ë©”ì¸ ê²€ìƒ‰" onkeyup="filterStores()">
                        <button onclick="filterStores()">ê²€ìƒ‰</button>
                    </div>
                    <div>
                        <button class="btn-secondary" onclick="loadStores()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                        <button class="btn-primary" onclick="location.href='02_Create_Store.html'">+ ì‹ ê·œ ë§¤ì¥ ë“±ë¡</button>
                    </div>
                </div>

                <!-- í•„í„° ì˜ì—­ -->
                <div class="filter-bar">
                    <div class="filter-group">
                        <label>ìƒíƒœ:</label>
                        <select id="statusFilter" onchange="filterStores()">
                            <option value="">ì „ì²´</option>
                            <option value="active">í™œì„±</option>
                            <option value="deprecated">ë¹„í™œì„±</option>
                        </select>
                    </div>
                    <div class="filter-stats">
                        <span id="totalCount">ì „ì²´: 0ê°œ</span>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Store ID</th>
                                <th>ì„œë¸Œë„ë©”ì¸</th>
                                <th>ë§¤ì¥ëª…</th>
                                <th>ì ì£¼ ID</th>
                                <th>ì£¼ì†Œ</th>
                                <th>ìƒíƒœ</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="storeTableBody">
                            <tr>
                                <td colspan="7" style="text-align:center;padding:40px;color:#6B7280;">
                                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = '235811';
        const API_BASE = '';
        let allStores = [];

        // ì¸ì¦ í™•ì¸
        function checkAuth() {
            const password = document.getElementById('authPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminAuth', 'true');
                document.getElementById('authOverlay').classList.add('hidden');
                document.getElementById('adminContainer').classList.remove('hidden');
                loadStores();
            } else {
                document.getElementById('authError').style.display = 'block';
                document.getElementById('authPassword').value = '';
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            sessionStorage.removeItem('adminAuth');
            location.reload();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
        window.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem('adminAuth') === 'true') {
                document.getElementById('authOverlay').classList.add('hidden');
                document.getElementById('adminContainer').classList.remove('hidden');
                loadStores();
            }
            
            // Enter í‚¤ ì²˜ë¦¬
            document.getElementById('authPassword').focus();
        });

        // ë§¤ì¥ ëª©ë¡ ë¡œë“œ (API í˜¸ì¶œ)
        async function loadStores() {
            const tbody = document.getElementById('storeTableBody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:40px;color:#6B7280;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';

            try {
                const response = await fetch(`${API_BASE}/api/v1/admin/stores`, {
                    headers: {
                        'X-Admin-Password': ADMIN_PASSWORD
                    }
                });

                if (!response.ok) {
                    throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
                }

                const result = await response.json();
                allStores = result.data || [];
                
                renderStores(allStores);

            } catch (error) {
                console.error('ë§¤ì¥ ë¡œë“œ ì‹¤íŒ¨:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align:center;padding:40px;color:#EF4444;">
                            âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br>
                            <small>${error.message}</small>
                        </td>
                    </tr>
                `;
            }
        }

        // ë§¤ì¥ ëª©ë¡ ë Œë”ë§
        function renderStores(stores) {
            const tbody = document.getElementById('storeTableBody');
            
            if (stores.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align:center;padding:40px;color:#6B7280;">
                            ë“±ë¡ëœ ë§¤ì¥ì´ ì—†ìŠµë‹ˆë‹¤
                        </td>
                    </tr>
                `;
                document.getElementById('totalCount').textContent = 'ì „ì²´: 0ê°œ';
                return;
            }

            tbody.innerHTML = stores.map(store => {
                const isDeprecated = store.subdomain && store.subdomain.includes('deprecated');
                const statusBadge = isDeprecated 
                    ? '<span class="badge stopped">ë¹„í™œì„±</span>'
                    : (store.isOpen ? '<span class="badge active">ì˜ì—…ì¤‘</span>' : '<span class="badge pending">ì˜ì—…ì¢…ë£Œ</span>');
                
                const subdomainCell = store.subdomain && !isDeprecated
                    ? `<a href="https://${store.subdomain}.maejang.com" target="_blank" class="subdomain-link">${store.subdomain}.maejang.com</a>`
                    : (store.subdomain ? `<span class="no-subdomain">${store.subdomain}</span>` : '<span class="no-subdomain">ë¯¸ì„¤ì •</span>');
                
                return `
                    <tr>
                        <td>${store.storeId}</td>
                        <td>${subdomainCell}</td>
                        <td>${store.storeName}</td>
                        <td>${store.ownerId || '-'}</td>
                        <td>${store.address || '-'}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn-sm" onclick="location.href='store_detail.html?id=${store.storeId}'">ìƒì„¸</button>
                            ${!isDeprecated ? `<button class="btn-sm btn-danger" onclick="deprecateStore(${store.storeId})">ë¹„í™œì„±í™”</button>` : ''}
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('totalCount').textContent = `ì „ì²´: ${stores.length}ê°œ`;
        }

        // í•„í„°ë§ í•¨ìˆ˜
        function filterStores() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            const filtered = allStores.filter(store => {
                // ê²€ìƒ‰ì–´ í•„í„°
                const matchSearch = 
                    (store.storeName || '').toLowerCase().includes(searchInput) || 
                    (store.subdomain || '').toLowerCase().includes(searchInput);
                
                // ìƒíƒœ í•„í„°
                let matchStatus = true;
                if (statusFilter === 'active') {
                    matchStatus = !store.subdomain?.includes('deprecated');
                } else if (statusFilter === 'deprecated') {
                    matchStatus = store.subdomain?.includes('deprecated');
                }

                return matchSearch && matchStatus;
            });

            renderStores(filtered);
        }

        // ë§¤ì¥ ë¹„í™œì„±í™”
        async function deprecateStore(storeId) {
            if (!confirm('ì´ ë§¤ì¥ì„ ë¹„í™œì„±í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì„œë¸Œë„ë©”ì¸ì´ -deprecated ì²˜ë¦¬ë©ë‹ˆë‹¤.')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/admin/store/${storeId}/deprecate`, {
                    method: 'POST',
                    headers: {
                        'X-Admin-Password': ADMIN_PASSWORD
                    }
                });

                if (!response.ok) {
                    throw new Error('ë¹„í™œì„±í™” ì‹¤íŒ¨');
                }

                alert('ë§¤ì¥ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadStores();

            } catch (error) {
                alert('ë¹„í™œì„±í™” ì‹¤íŒ¨: ' + error.message);
            }
        }
    </script>
</body>
</html>
