<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>매장 상세 - D2C Admin</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .detail-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #E5E7EB;
        }

        .detail-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1F2937;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .info-section {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #F3F4F6;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-item.full-width {
            grid-column: 1 / -1;
        }

        .info-label {
            font-size: 14px;
            font-weight: 500;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .info-value {
            font-size: 15px;
            color: #1F2937;
            padding: 10px 12px;
            background: #F9FAFB;
            border-radius: 6px;
        }

        .info-value input,
        .info-value textarea,
        .info-value select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 15px;
        }

        .info-value textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #4F46E5;
            color: white;
        }

        .btn-primary:hover {
            background: #4338CA;
        }

        .btn-secondary {
            background: white;
            color: #374151;
            border: 1px solid #D1D5DB;
        }

        .btn-secondary:hover {
            background: #F9FAFB;
        }

        .btn-danger {
            background: #EF4444;
            color: white;
        }

        .btn-danger:hover {
            background: #DC2626;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- 사이드바 -->
        <nav class="sidebar">
            <div class="logo-area">
                <h2>D2C Admin</h2>
            </div>
            <ul class="menu-list">
                <li class="menu-item active"><a href="index.html">매장 관리</a></li>
                <li class="menu-item"><a href="01_Store_Match.html">매장 매칭</a></li>
                <li class="menu-item"><a href="03_User_Management.html">회원 관리</a></li>
                <li class="menu-item"><a href="#">주문 현황</a></li>
                <li class="menu-item"><a href="#">설정</a></li>
            </ul>
        </nav>

        <!-- 메인 컨텐츠 -->
        <div class="main-content">
            <!-- 탑바 -->
            <header class="topbar">
                <div class="page-title">매장 상세 정보</div>
                <div class="user-info">
                    <span>Super Admin님</span>
                    <button class="btn-logout" onclick="location.href='index.html'">돌아가기</button>
                </div>
            </header>

            <!-- 컨텐츠 영역 -->
            <main class="content-area">
                <div class="detail-container">
                    <div class="detail-header">
                        <h1 id="storeTitleName">매장 정보</h1>
                        <div class="header-actions">
                            <button id="btnEdit" class="btn btn-primary" onclick="enableEditMode()">수정</button>
                            <button id="btnSave" class="btn btn-primary hidden" onclick="saveStore()">저장</button>
                            <button id="btnCancel" class="btn btn-secondary hidden" onclick="cancelEdit()">취소</button>
                            <button id="btnDelete" class="btn btn-danger" onclick="deleteStore()">삭제</button>
                        </div>
                    </div>

                    <!-- 기본 정보 -->
                    <div class="info-section">
                        <h3 class="section-title">기본 정보</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">매장 ID</div>
                                <div class="info-value" id="displayStoreId">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">서브도메인</div>
                                <div class="info-value">
                                    <span id="displaySubdomain">-</span>
                                    <input type="text" id="editSubdomain" class="hidden">
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">매장명</div>
                                <div class="info-value">
                                    <span id="displayStoreName">-</span>
                                    <input type="text" id="editStoreName" class="hidden">
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">점주 ID</div>
                                <div class="info-value" id="displayOwnerId">-</div>
                            </div>
                            <div class="info-item full-width">
                                <div class="info-label">주소</div>
                                <div class="info-value">
                                    <span id="displayAddress">-</span>
                                    <input type="text" id="editAddress" class="hidden">
                                </div>
                            </div>
                            <div class="info-item full-width">
                                <div class="info-label">매장 소개</div>
                                <div class="info-value">
                                    <span id="displayDescription">-</span>
                                    <textarea id="editDescription" class="hidden"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 운영 정보 -->
                    <div class="info-section">
                        <h3 class="section-title">운영 정보</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">영업 시작 시간</div>
                                <div class="info-value" id="displayOpenTime">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">영업 종료 시간</div>
                                <div class="info-value" id="displayCloseTime">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">영업 상태</div>
                                <div class="info-value" id="displayIsOpen">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- 배달 정보 -->
                    <div class="info-section">
                        <h3 class="section-title">배달 정보</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">배달 반경 (km)</div>
                                <div class="info-value" id="displayDeliveryRadius">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">위도</div>
                                <div class="info-value" id="displayLatitude">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">경도</div>
                                <div class="info-value" id="displayLongitude">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = '235811';
        const API_BASE = '';
        const urlParams = new URLSearchParams(window.location.search);
        const storeId = urlParams.get('id');
        let storeData = null;

        window.addEventListener('DOMContentLoaded', () => {
            loadStoreDetail();
        });

        async function loadStoreDetail() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/store/${storeId}`);
                const result = await response.json();

                if (!result.success || !result.data) {
                    alert('매장 정보를 불러올 수 없습니다.');
                    location.href = 'index.html';
                    return;
                }

                storeData = result.data;
                displayStoreInfo(storeData);

            } catch (error) {
                console.error('매장 정보 로드 실패:', error);
                alert('매장 정보를 불러오는 중 오류가 발생했습니다.');
            }
        }

        function displayStoreInfo(data) {
            document.getElementById('storeTitleName').textContent = data.storeName || '매장 정보';
            document.getElementById('displayStoreId').textContent = data.storeId || '-';
            document.getElementById('displaySubdomain').textContent = data.subdomain || '-';
            document.getElementById('displayStoreName').textContent = data.storeName || '-';
            document.getElementById('displayOwnerId').textContent = data.ownerId || '미지정';
            document.getElementById('displayAddress').textContent = data.address || '-';
            document.getElementById('displayDescription').textContent = data.description || '-';
            document.getElementById('displayOpenTime').textContent = data.openTime || '-';
            document.getElementById('displayCloseTime').textContent = data.closeTime || '-';
            document.getElementById('displayIsOpen').textContent = data.isOpen ? '영업중' : '영업종료';
            document.getElementById('displayDeliveryRadius').textContent = data.deliveryRadius || '-';
            document.getElementById('displayLatitude').textContent = data.latitude || '-';
            document.getElementById('displayLongitude').textContent = data.longitude || '-';

            // 수정 폼에도 값 넣기
            document.getElementById('editSubdomain').value = data.subdomain || '';
            document.getElementById('editStoreName').value = data.storeName || '';
            document.getElementById('editAddress').value = data.address || '';
            document.getElementById('editDescription').value = data.description || '';
        }

        function enableEditMode() {
            // 버튼 토글
            document.getElementById('btnEdit').classList.add('hidden');
            document.getElementById('btnDelete').classList.add('hidden');
            document.getElementById('btnSave').classList.remove('hidden');
            document.getElementById('btnCancel').classList.remove('hidden');

            // 편집 가능 필드 활성화
            document.getElementById('displaySubdomain').classList.add('hidden');
            document.getElementById('editSubdomain').classList.remove('hidden');
            
            document.getElementById('displayStoreName').classList.add('hidden');
            document.getElementById('editStoreName').classList.remove('hidden');
            
            document.getElementById('displayAddress').classList.add('hidden');
            document.getElementById('editAddress').classList.remove('hidden');
            
            document.getElementById('displayDescription').classList.add('hidden');
            document.getElementById('editDescription').classList.remove('hidden');
        }

        function cancelEdit() {
            // 버튼 토글
            document.getElementById('btnEdit').classList.remove('hidden');
            document.getElementById('btnDelete').classList.remove('hidden');
            document.getElementById('btnSave').classList.add('hidden');
            document.getElementById('btnCancel').classList.add('hidden');

            // 편집 필드 숨기기
            document.getElementById('displaySubdomain').classList.remove('hidden');
            document.getElementById('editSubdomain').classList.add('hidden');
            
            document.getElementById('displayStoreName').classList.remove('hidden');
            document.getElementById('editStoreName').classList.add('hidden');
            
            document.getElementById('displayAddress').classList.remove('hidden');
            document.getElementById('editAddress').classList.add('hidden');
            
            document.getElementById('displayDescription').classList.remove('hidden');
            document.getElementById('editDescription').classList.add('hidden');

            // 원래 값으로 복원
            displayStoreInfo(storeData);
        }

        async function saveStore() {
            const updatedData = {
                userId: storeData.ownerId,
                storeName: document.getElementById('editStoreName').value,
                subdomain: document.getElementById('editSubdomain').value,
                address: document.getElementById('editAddress').value,
                description: document.getElementById('editDescription').value
            };

            try {
                const response = await fetch(`${API_BASE}/api/v1/admin/store/${storeId}/update`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Password': ADMIN_PASSWORD
                    },
                    body: JSON.stringify(updatedData)
                });

                const result = await response.json();

                if (result.success) {
                    alert('매장 정보가 수정되었습니다.');
                    loadStoreDetail();
                    cancelEdit();
                } else {
                    alert('수정 실패: ' + (result.message || '알 수 없는 오류'));
                }

            } catch (error) {
                console.error('매장 수정 실패:', error);
                alert('매장 정보 수정 중 오류가 발생했습니다.');
            }
        }

        async function deleteStore() {
            if (!confirm('정말로 이 매장을 삭제하시겠습니까?\n\n⚠️ 주의: 관련된 모든 데이터(메뉴, 주문 등)가 함께 삭제될 수 있습니다.\n\n비활성화를 원하시면 매장 목록에서 "비활성화" 버튼을 사용하세요.')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/admin/store/${storeId}/delete`, {
                    method: 'DELETE',
                    headers: {
                        'X-Admin-Password': ADMIN_PASSWORD
                    }
                });

                const result = await response.json();

                if (result.success) {
                    alert('매장이 삭제되었습니다.');
                    location.href = 'index.html';
                } else {
                    alert('삭제 실패: ' + (result.message || '알 수 없는 오류'));
                }

            } catch (error) {
                console.error('매장 삭제 실패:', error);
                alert('매장 삭제 중 오류가 발생했습니다.');
            }
        }
    </script>
</body>
</html>
