<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì› ê´€ë¦¬ - D2C Admin</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .auth-modal {
            background: white;
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .auth-modal h2 {
            font-size: 24px;
            margin-bottom: 8px;
            color: #1F2937;
        }
        
        .auth-modal p {
            color: #6B7280;
            margin-bottom: 24px;
        }
        
        .auth-modal input {
            width: 100%;
            padding: 14px;
            font-size: 18px;
            text-align: center;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            margin-bottom: 16px;
            letter-spacing: 4px;
        }
        
        .auth-modal input:focus {
            outline: none;
            border-color: #4F46E5;
        }
        
        .auth-modal button {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            background: #4F46E5;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .auth-modal button:hover {
            background: #4338CA;
        }
        
        .auth-error {
            color: #EF4444;
            font-size: 14px;
            margin-top: 12px;
            display: none;
        }
        
        .hidden {
            display: none !important;
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .role-owner {
            background: #DBEAFE;
            color: #1E40AF;
        }

        .role-customer {
            background: #D1FAE5;
            color: #065F46;
        }

        .role-admin {
            background: #FEE2E2;
            color: #991B1B;
        }
    </style>
</head>
<body>
    <!-- ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ëª¨ë‹¬ -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-modal">
            <h2>ğŸ” ê´€ë¦¬ì ì¸ì¦</h2>
            <p>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            <input type="password" id="authPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" maxlength="10" onkeyup="if(event.key==='Enter') checkAuth()">
            <button onclick="checkAuth()">í™•ì¸</button>
            <div class="auth-error" id="authError">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤</div>
        </div>
    </div>

    <div class="admin-container hidden" id="adminContainer">
        <!-- ì‚¬ì´ë“œë°” -->
        <nav class="sidebar">
            <div class="logo-area">
                <h2>D2C Admin</h2>
            </div>
            <ul class="menu-list">
                <li class="menu-item"><a href="index.html">ë§¤ì¥ ê´€ë¦¬</a></li>
                <li class="menu-item"><a href="01_Store_Match.html">ë§¤ì¥ ë§¤ì¹­</a></li>
                <li class="menu-item active"><a href="03_User_Management.html">íšŒì› ê´€ë¦¬</a></li>
                <li class="menu-item"><a href="#">ì£¼ë¬¸ í˜„í™©</a></li>
                <li class="menu-item"><a href="#">ì„¤ì •</a></li>
            </ul>
        </nav>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="main-content">
            <!-- íƒ‘ë°” -->
            <header class="topbar">
                <div class="page-title">íšŒì› ê´€ë¦¬</div>
                <div class="user-info">
                    <span>Super Adminë‹˜</span>
                    <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </header>

            <!-- ì»¨í…ì¸  ì˜ì—­ -->
            <main class="content-area">
                <div class="action-bar">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼ ê²€ìƒ‰" onkeyup="filterUsers()">
                        <button onclick="filterUsers()">ê²€ìƒ‰</button>
                    </div>
                    <div>
                        <button class="btn-secondary" onclick="loadUsers()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>

                <!-- í•„í„° ì˜ì—­ -->
                <div class="filter-bar">
                    <div class="filter-group">
                        <label>ì—­í• :</label>
                        <select id="roleFilter" onchange="filterUsers()">
                            <option value="">ì „ì²´</option>
                            <option value="OWNER">ì ì£¼</option>
                            <option value="CUSTOMER">ê³ ê°</option>
                            <option value="ADMIN">ê´€ë¦¬ì</option>
                        </select>
                    </div>
                    <div class="filter-stats">
                        <span id="totalCount">ì „ì²´: 0ëª…</span>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ì´ë¦„</th>
                                <th>ì—­í• </th>
                                <th>ê°€ì…ì¼</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                            <tr>
                                <td colspan="6" style="text-align:center;padding:40px;color:#6B7280;">
                                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = '235811';
        const API_BASE = '';
        let allUsers = [];

        // ì¸ì¦ í™•ì¸
        function checkAuth() {
            const password = document.getElementById('authPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminAuth', 'true');
                document.getElementById('authOverlay').classList.add('hidden');
                document.getElementById('adminContainer').classList.remove('hidden');
                loadUsers();
            } else {
                document.getElementById('authError').style.display = 'block';
                document.getElementById('authPassword').value = '';
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            sessionStorage.removeItem('adminAuth');
            location.reload();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
        window.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem('adminAuth') === 'true') {
                document.getElementById('authOverlay').classList.add('hidden');
                document.getElementById('adminContainer').classList.remove('hidden');
                loadUsers();
            }
            
            document.getElementById('authPassword').focus();
        });

        // ìœ ì € ëª©ë¡ ë¡œë“œ
        async function loadUsers() {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:#6B7280;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';

            try {
                const response = await fetch(`${API_BASE}/api/v1/admin/users/all`, {
                    headers: {
                        'X-Admin-Password': ADMIN_PASSWORD
                    }
                });

                if (!response.ok) {
                    throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
                }

                const result = await response.json();
                allUsers = result.data || [];
                
                renderUsers(allUsers);

            } catch (error) {
                console.error('ìœ ì € ë¡œë“œ ì‹¤íŒ¨:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align:center;padding:40px;color:#EF4444;">
                            âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br>
                            <small>${error.message}</small>
                        </td>
                    </tr>
                `;
            }
        }

        // ìœ ì € ëª©ë¡ ë Œë”ë§
        function renderUsers(users) {
            const tbody = document.getElementById('userTableBody');
            
            if (users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align:center;padding:40px;color:#6B7280;">
                            ë“±ë¡ëœ ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤
                        </td>
                    </tr>
                `;
                document.getElementById('totalCount').textContent = 'ì „ì²´: 0ëª…';
                return;
            }

            tbody.innerHTML = users.map(user => {
                let roleBadgeClass = 'role-customer';
                let roleText = 'ê³ ê°';
                
                if (user.role === 'OWNER') {
                    roleBadgeClass = 'role-owner';
                    roleText = 'ì ì£¼';
                } else if (user.role === 'ADMIN') {
                    roleBadgeClass = 'role-admin';
                    roleText = 'ê´€ë¦¬ì';
                }
                
                const createdDate = user.createdAt ? new Date(user.createdAt).toLocaleDateString() : '-';
                
                return `
                    <tr>
                        <td>${user.userId}</td>
                        <td>${user.email}</td>
                        <td>${user.name || '-'}</td>
                        <td><span class="role-badge ${roleBadgeClass}">${roleText}</span></td>
                        <td>${createdDate}</td>
                        <td>
                            <button class="btn-sm" onclick="viewUserDetail(${user.userId})">ìƒì„¸</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('totalCount').textContent = `ì „ì²´: ${users.length}ëª…`;
        }

        // í•„í„°ë§ í•¨ìˆ˜
        function filterUsers() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;

            const filtered = allUsers.filter(user => {
                // ê²€ìƒ‰ì–´ í•„í„°
                const matchSearch = 
                    (user.email || '').toLowerCase().includes(searchInput) || 
                    (user.name || '').toLowerCase().includes(searchInput);
                
                // ì—­í•  í•„í„°
                const matchRole = !roleFilter || user.role === roleFilter;

                return matchSearch && matchRole;
            });

            renderUsers(filtered);
        }

        // ìœ ì € ìƒì„¸ í˜ì´ì§€ (ì¶”í›„ êµ¬í˜„)
        function viewUserDetail(userId) {
            alert(`User ID ${userId}ì˜ ìƒì„¸ í˜ì´ì§€ëŠ” ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.`);
        }
    </script>
</body>
</html>

