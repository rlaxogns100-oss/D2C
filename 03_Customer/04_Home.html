<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>04 Home</title>
  <link rel="stylesheet" href="style.css">
  <script src="config.js"></script>
</head>
<body>
  <div class="screen-label">í™ˆ</div>
  
  <div class="container">
    <!-- Restaurant Card -->
    <div class="restaurant-card">
      <!-- Image with Menu Button -->
      <div class="image-card">
        <button class="icon-btn menu-btn" id="menuBtn" onclick="toggleDropdown()">
          <svg class="chevron" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="5" r="1.5" fill="currentColor"/>
            <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
            <circle cx="12" cy="19" r="1.5" fill="currentColor"/>
          </svg>
        </button>
        
        <!-- Dropdown Menu -->
        <div class="dropdown-menu" id="dropdownMenu">
          <div class="dropdown-item" onclick="location.href='07_Cart.html'">ì¥ë°”êµ¬ë‹ˆ</div>
          <div class="dropdown-item" onclick="location.href='08_My_Orders.html'">ì£¼ë¬¸ ë‚´ì—­</div>
          <div class="dropdown-item" onclick="location.href='09_Address.html'">ì£¼ì†Œ ê´€ë¦¬</div>
          <div class="dropdown-item" onclick="location.href='12_Payment_Edit.html'">ê²°ì œ ìˆ˜ë‹¨ ê´€ë¦¬</div>
          <div class="dropdown-item" onclick="location.href='13_Terms.html'">ì´ìš©ì•½ê´€</div>
        </div>
        
        <!-- Pagination Dots -->
        <div class="pagination-dots">
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot active"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
      </div>
      
      <!-- Restaurant Info -->
      <div class="info-section">
        <div class="info-item rating">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <span>4.7</span>
        </div>
        
        <div class="info-item delivery">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="3" width="15" height="13" rx="2"/>
            <path d="M16 8h4l3 3v5h-3"/>
            <circle cx="5.5" cy="18.5" r="2.5"/>
            <circle cx="18.5" cy="18.5" r="2.5"/>
          </svg>
          <span>2,500ì›</span>
        </div>
        
        <div class="info-item time">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          <span>20ë¶„</span>
        </div>
      </div>
      
      <!-- Restaurant Name -->
      <h2 class="restaurant-name" id="restaurantName">ë¡œë”© ì¤‘...</h2>
      
      <!-- Description -->
      <p class="description" id="restaurantDesc">ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
      
      <!-- Category Tabs -->
      <div class="category-tabs" id="categoryTabs">
        <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
      </div>
      
      <!-- Products Section -->
      <div class="section-header">
        <h3 id="categoryTitle">ì „ì²´ <span class="item-count" id="itemCount">(0)</span></h3>
      </div>
      
      <!-- Product Grid -->
      <div class="product-grid" id="productGrid">
        <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
      </div>

      <!-- Business Info -->
      <div class="business-info" style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee; font-size: 11px; color: #999; line-height: 1.6;">
        <div style="margin-bottom: 4px;">
          <span style="margin-right: 10px;"><strong>ìƒí˜¸ëª…</strong> : ë§¤ì¥ì§ê²°</span>
          <span style="margin-right: 10px;"><strong>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</strong> : 140-29-01759</span>
          <span><strong>ëŒ€í‘œìëª…</strong> : ê¹€íƒœí›ˆ</span>
        </div>
        <div style="margin-bottom: 4px;">
          <strong>ì‚¬ì—…ì¥ì£¼ì†Œ</strong> : ê²½ê¸°ë„ ìš©ì¸ì‹œ ìˆ˜ì§€êµ¬ í˜„ì•”ë¡œ125ë²ˆê¸¸ 11, 723ë™ 704í˜¸ (ì£½ì „ë™, ìƒˆí„°ë§ˆì„ ì•„íŒŒíŠ¸)
          <span style="margin-left: 10px;"><strong>ì—°ë½ì²˜</strong> : 010-2808-9914</span>
        </div>
        <div>
          <span style="margin-right: 10px;"><strong>ì´ë©”ì¼</strong> : rlaxogns100@snu.ac.kr</span>
          <span style="margin-right: 10px;"><strong>í†µì‹ íŒë§¤ì—… ì‹ ê³ ë²ˆí˜¸</strong> : ì‹ ê³  ì¤€ë¹„ì¤‘</span>
          <span style="margin-right: 10px;"><strong>ê³¼ì„¸ìœ í˜•</strong> : ì¼ë°˜ê³¼ì„¸ì</span>
          <span><strong>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</strong> : -</span>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // âš ï¸ config.jsì—ì„œ baseUrl, OWNER_IDê°€ ìë™ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤
    // ê¸°ì¡´ ì½”ë“œ í˜¸í™˜ì„±ì„ ìœ„í•´ ì•„ë˜ ì½”ë“œëŠ” ì£¼ì„ ì²˜ë¦¬ (ì‚­ì œí•˜ì§€ ë§ˆì„¸ìš”!)
    // const baseUrl = window.location.protocol === 'file:' 
    //   ? 'https://pizzaschool.maejang.com'
    //   : '';
    // const OWNER_ID = 11;

    let allMenus = [];  // ì „ì²´ ë©”ë‰´ ì €ì¥
    let currentCategory = 'ì „ì²´';

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë©”ë‰´ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    document.addEventListener('DOMContentLoaded', async () => {
      // config.jsì˜ ë§¤ì¥ ì •ë³´ ë¡œë“œ ëŒ€ê¸° (í•„ìˆ˜)
      if (window.STORE_CONFIG_LOADED) {
        await window.STORE_CONFIG_LOADED;
      }
      
      console.log('[Customer Home] Page loaded, fetching menus...');
      console.log('[Customer Home] Store Owner ID:', OWNER_ID);
      
      try {
        // ì´ ë§¤ì¥(OWNER_ID)ì˜ ë©”ë‰´ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        // ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œë„ ì¡°íšŒ ê°€ëŠ¥
        const menuResponse = await fetch(`${baseUrl}/api/v1/menu/read?ownerId=${OWNER_ID}`, {
          credentials: 'include'
        });

        if (!menuResponse.ok) {
          throw new Error('ë©”ë‰´ ëª©ë¡ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        const menuData = await menuResponse.json();
        console.log('[Customer Home] Menus:', menuData);

        if (menuData.success && menuData.data) {
          allMenus = menuData.data;  // ì „ì²´ ë©”ë‰´ ì €ì¥
          
          // ê°€ê²Œ ì´ë¦„ ì—…ë°ì´íŠ¸ (ì²« ë²ˆì§¸ ë©”ë‰´ì˜ owner ì •ë³´ í™œìš©)
          if (allMenus.length > 0) {
            document.getElementById('restaurantName').textContent = 'Spicy Restaurant';  // TODO: ê°€ê²Œ ì •ë³´ API ì—°ë™
            document.getElementById('restaurantDesc').textContent = 'ë‹¤ì–‘í•œ ë©”ë‰´ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”!';
          }
          
          // ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ ë° ë Œë”ë§
          renderCategoryTabs();
          
          // ì „ì²´ ë©”ë‰´ í‘œì‹œ
          filterByCategory('ì „ì²´');
        }

      } catch (error) {
        console.error('[Customer Home] Error:', error);
        document.getElementById('restaurantName').textContent = 'Spicy Restaurant';
        document.getElementById('restaurantDesc').textContent = 'ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        document.getElementById('productGrid').innerHTML = `
          <div style="text-align: center; padding: 60px 24px; color: var(--text-gray); grid-column: 1 / -1;">
            <p style="font-size: 16px; margin-bottom: 12px;">ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
            <p style="font-size: 14px;">${error.message}</p>
          </div>
        `;
      }
    });

    // ì¹´í…Œê³ ë¦¬ íƒ­ ë Œë”ë§
    function renderCategoryTabs() {
      // "ì „ì²´"ë¥¼ ì œì™¸í•œ ê³ ìœ  ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
      const uniqueCategories = [...new Set(allMenus.map(m => m.category).filter(c => c && c !== 'ì „ì²´'))];
      const categories = ['ì „ì²´', ...uniqueCategories];
      
      const tabsContainer = document.getElementById('categoryTabs');
      tabsContainer.innerHTML = categories.map(cat => 
        `<button class="tab-btn ${cat === currentCategory ? 'active' : ''}" onclick="filterByCategory('${cat}')">${cat}</button>`
      ).join('');
    }

    // ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§
    function filterByCategory(category) {
      currentCategory = category;
      
      // íƒ­ active ìƒíƒœ ë³€ê²½
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.trim() === category) {
          btn.classList.add('active');
        }
      });
      
      // í•„í„°ë§
      const filtered = category === 'ì „ì²´' 
        ? allMenus 
        : allMenus.filter(menu => menu.category === category);
      
      // ì œëª© ì—…ë°ì´íŠ¸
      document.getElementById('categoryTitle').innerHTML = `${category} <span class="item-count" id="itemCount">(${filtered.length})</span>`;
      
      // ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
      renderMenuList(filtered);
    }

    // ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    function renderMenuList(menus) {
      const productGrid = document.getElementById('productGrid');

      if (menus.length === 0) {
        productGrid.innerHTML = `
          <div style="text-align: center; padding: 60px 24px; color: var(--text-gray); grid-column: 1 / -1;">
            <p style="font-size: 16px; margin-bottom: 12px;">ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
          </div>
        `;
        return;
      }

      productGrid.innerHTML = menus.map(menu => {
        // ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš°ì™€ ì—†ëŠ” ê²½ìš° ë¶„ë¦¬
        const imageContent = menu.picture 
          ? `<div class="product-image" style="background-image: url('${menu.picture}'); background-size: cover; background-position: center;"></div>`
          : `<div class="product-image" style="background: #F5F5F5; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;">
               <div style="font-size: 48px;">ğŸ½ï¸</div>
               <div style="font-size: 12px; color: #9E9E9E;">ë“±ë¡í•œ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤</div>
             </div>`;
        
        return `
          <div class="product-card" onclick="viewMenuDetail(${menu.menuId})" style="cursor: pointer;">
            ${imageContent}
            <div class="product-info">
              <h4 class="product-name">${menu.menuName}</h4>
              <p class="product-restaurant">${menu.description || 'Spicy Restaurant'}</p>
              <div class="product-footer">
                <span class="product-price">${menu.price.toLocaleString()}ì›</span>
                <button class="add-btn" onclick="event.stopPropagation(); viewMenuDetail(${menu.menuId})">+</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // ë©”ë‰´ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
    function viewMenuDetail(menuId) {
      location.href = `06_Food_Details.html?menuId=${menuId}`;
    }

    // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ í† ê¸€
    function toggleDropdown() {
      const menu = document.getElementById('dropdownMenu');
      const btn = document.getElementById('menuBtn');
      
      menu.classList.toggle('active');
      btn.classList.toggle('active');
    }
    
    // ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener('click', function(event) {
      const menu = document.getElementById('dropdownMenu');
      const btn = document.getElementById('menuBtn');
      
      if (!menu.contains(event.target) && !btn.contains(event.target)) {
        menu.classList.remove('active');
        btn.classList.remove('active');
      }
    });
  </script>
</body>
</html>
