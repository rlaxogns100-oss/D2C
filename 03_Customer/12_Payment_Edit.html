<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê²°ì œ ìˆ˜ë‹¨ ê´€ë¦¬</title>
  <link rel="stylesheet" href="style.css">
  <script src="storage.js"></script>
  <!-- í† ìŠ¤í˜ì´ë¨¼ì¸  SDK v2 -->
  <script src="https://js.tosspayments.com/v2/standard"></script>
</head>
<body>
  <div class="screen-label">ê²°ì œ ìˆ˜ë‹¨ ê´€ë¦¬</div>
  
  <div class="container">
    <!-- Header -->
    <div class="section-header">
      <button class="icon-btn back-btn" onclick="history.back()" style="position: static; margin-right: 16px;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      <h2 style="margin: 0; flex: 1;">ê²°ì œ ìˆ˜ë‹¨ ê´€ë¦¬</h2>
    </div>

    <!-- ê³„ì•½ ì•ˆë‚´ ë¬¸êµ¬ (í•­ìƒ í‘œì‹œ) -->
    <div style="padding: 20px; text-align: center; color: #666; background-color: #f8f9fa; border-radius: 12px; margin-bottom: 16px;">
        <p style="font-weight: 600; font-size: 16px; margin-bottom: 8px;">í† ìŠ¤í˜ì´ë¨¼ì¸  ê³„ì•½ ì²´ê²° ì¤‘ì…ë‹ˆë‹¤.</p>
        <p>ê³„ì¢Œì´ì²´ë¡œ ë¶€íƒë“œë ¤ìš” ğŸ˜­</p>
    </div>

    <!-- Registered Cards List -->
    <div class="card-list">
      <!-- Card Item 1 -->
      <div class="address-card">
        <div class="address-header">
          <div class="address-icon" style="background-color: #3B5998; color: white;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
              <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
          </div>
          <span class="address-label">ì‹ í•œì¹´ë“œ Deep Dream</span>
          <div class="address-actions">
            <button class="icon-action-btn delete" onclick="confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="address-text">
          <p style="font-size: 16px; font-weight: 600; color: var(--text-dark);">**** **** **** 1234</p>
          <p>ë§Œë£Œì¼: 12/25</p>
        </div>
      </div>

      <!-- Card Item 2 -->
      <div class="address-card">
        <div class="address-header">
          <div class="address-icon" style="background-color: #FFC107; color: white;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
              <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
          </div>
          <span class="address-label">êµ­ë¯¼ì¹´ë“œ My WE:SH</span>
          <div class="address-actions">
            <button class="icon-action-btn delete" onclick="confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="address-text">
          <p style="font-size: 16px; font-weight: 600; color: var(--text-dark);">**** **** **** 5678</p>
          <p>ë§Œë£Œì¼: 08/26</p>
        </div>
      </div>
    </div>

    <!-- Add New Card Button -->
    <button id="billing-button" class="btn-primary" style="display: flex; align-items: center; justify-content: center; gap: 8px;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      ìƒˆ ì¹´ë“œ ë“±ë¡
    </button>
  </div>

  <script>
    function generateRandomString() {
      return window.btoa(Math.random()).slice(0, 20);
    }

    document.addEventListener("DOMContentLoaded", async function () {
      const button = document.getElementById("billing-button");

      // ------ ìë™ê²°ì œ(ë¹Œë§) ê²°ì œì°½ ì´ˆê¸°í™” ------
      // 1. ì‚¬ìš©ìê°€ ê°€ì ¸ì˜¨ íŒŒì¼(billing.html)ì— ìˆë˜ ì›ë˜ í‚¤ë¥¼ ì‚¬ìš©í•´ë´…ë‹ˆë‹¤.
      // (ì¼ë°˜ ê²°ì œìš© í‚¤ì™€ ë¹Œë§ìš© í‚¤ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)
      const clientKey = "test_ck_vZnjEJeQVxePJdEMyexZrPmOoBN0"; 
      const customerKey = generateRandomString();
      
      try {
        const tossPayments = TossPayments(clientKey);
        const payment = tossPayments.payment({ customerKey });

        // 'ì¹´ë“œ ë“±ë¡í•˜ê¸°' ë²„íŠ¼ í´ë¦­ ì‹œ ìë™ê²°ì œ(ë¹Œë§) ì¹´ë“œ ë“±ë¡ì°½ í˜¸ì¶œ
        button.addEventListener("click", async function () {
          console.log("ì¹´ë“œ ë“±ë¡ ë²„íŠ¼ í´ë¦­ë¨");
          try {
            await payment.requestBillingAuth({
              method: "CARD",
              successUrl: window.location.origin + "/billing_success.html",
              failUrl: window.location.origin + "/billing_fail.html",
            });
          } catch (error) {
            console.error("ì¹´ë“œ ë“±ë¡ ì—ëŸ¬:", error);
            // ì—ëŸ¬ ë‚´ìš©ì„ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
            alert(`ì¹´ë“œ ë“±ë¡ ì‹¤íŒ¨\nì—ëŸ¬ ì½”ë“œ: ${error.code}\në©”ì‹œì§€: ${error.message}`);
          }
        });
      } catch (error) {
        console.error("í† ìŠ¤í˜ì´ë¨¼ì¸  ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
        alert("í† ìŠ¤í˜ì´ë¨¼ì¸  ì´ˆê¸°í™” ì‹¤íŒ¨: " + error.message);
      }
    });
  </script>
</body>
</html>
